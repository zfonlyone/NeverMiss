# 任务2：增强循环设置

## 需求描述
分离循环天数设置的功能，拆分为小组件。添加循环周期支持：大小周、每月固定日期、每年固定天数、每周固定星期几以及每月第几个星期几等高级循环模式。

## 技术分析
当前循环设置功能实现在 `components/RecurrenceSettings.tsx` 中，需要重构为模块化组件，并扩展支持更多循环模式。

## 实施计划

### 1. 创建独立的循环设置组件
- 创建 `components/widgets/RecurrenceSettingsWidget.tsx` 组件
- 从现有 `RecurrenceSettings.tsx` 提取核心功能
- 设计清晰的组件接口，使其可以在不同页面复用

### 2. 扩展 RecurrencePattern 模型
- 更新 `Task.ts` 中的 RecurrencePattern 接口，添加新的循环模式属性：
  - `weekType`: 大周/小周 (alternateWeeks)
  - `monthDay`: 每月固定日期 (如每月15号)
  - `yearDay`: 每年固定天数 (如每年第100天)
  - `weekDay`: 每周固定星期几
  - `monthWeekDay`: 每月第几个星期几 (如每月第一个星期一)

### 3. 实现大小周功能
- 添加大小周选择组件
- 实现大小周的日期计算逻辑
- 更新任务生成逻辑，支持大小周循环

### 4. 实现每月固定日期功能
- 添加月份日期选择器
- 处理月末日期边界情况 (如31日在小月)
- 实现按月日期的任务生成逻辑

### 5. 实现每年固定天数功能
- 添加年度天数选择器
- 处理闰年特殊情况
- 实现按年天数的任务生成逻辑

### 6. 实现每周固定星期几功能
- 添加星期几多选功能
- 支持选择多个星期几
- 实现按星期几的任务生成逻辑

### 7. 实现每月第几个星期几功能
- 添加月份星期选择器 (如"第一个"、"第二个"等)
- 添加星期几选择器
- 实现按月星期的任务生成逻辑

### 8. 更新任务表单和详情页
- 将新组件集成到任务表单
- 更新任务详情页，显示更丰富的循环信息
- 添加循环预览功能，展示下几次任务的执行时间

## 相关文件
- `models/Task.ts` - 循环模式定义
- `components/RecurrenceSettings.tsx` - 现有循环设置组件
- 待创建: `components/widgets/RecurrenceSettingsWidget.tsx` - 新循环设置组件
- `components/TaskFormInline.tsx` - 任务表单
- `services/taskService.ts` - 任务服务，包含循环任务生成逻辑

## 注意事项
- 确保新循环模式不会破坏现有任务的循环逻辑
- 实现数据库迁移策略，处理新旧版本之间的数据转换
- UI 设计要简洁直观，避免过于复杂的设置界面
- 提供适当的预设和默认值，减少用户输入负担
- 考虑农历日期与新循环模式的结合使用场景 