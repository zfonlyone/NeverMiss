# 任务8：代码重组

## 需求描述
整理代码结构，按类型分别存放在不同文件夹，同时修复移动后的导入路径问题。目的是提高代码的可维护性和可扩展性。

## 技术分析
随着项目功能的不断增加，当前的代码结构已显得较为混乱。需要进行全面的重构，使代码组织更加清晰、模块化，并确保重构过程不影响现有功能。

## 实施计划

### 1. 分析当前代码结构
- 审查所有代码文件的依赖关系
- 识别代码中的逻辑分组
- 设计新的目录结构，遵循最佳实践

### 2. 创建新的目录结构
```
NeverMiss/
├── app/                 # Expo Router 页面
├── src/                 # 源代码主目录
│   ├── components/      # 可复用UI组件
│   │   ├── common/      # 通用基础组件
│   │   ├── forms/       # 表单相关组件
│   │   ├── lists/       # 列表相关组件
│   │   └── widgets/     # 独立功能组件
│   ├── hooks/           # 自定义React钩子
│   ├── contexts/        # React上下文提供者
│   ├── models/          # 数据模型定义
│   ├── services/        # 业务逻辑服务
│   │   ├── api/         # API交互
│   │   ├── storage/     # 数据存储
│   │   └── system/      # 系统服务(通知等)
│   ├── utils/           # 工具函数
│   │   ├── date/        # 日期处理
│   │   ├── format/      # 格式化
│   │   └── validation/  # 数据验证
│   ├── constants/       # 常量定义
│   ├── types/           # TypeScript类型定义
│   ├── navigation/      # 导航相关
│   ├── themes/          # 主题定义
│   ├── locales/         # 国际化文件
│   └── migrations/      # 数据迁移脚本
└── assets/              # 静态资源
```

### 3. 移动文件到新目录结构
- 创建迁移计划，列出每个文件将移动到的新位置
- 制定批量移动策略，尽量减少冲突
- 保留暂时需要的旧文件，等测试通过后再删除

### 4. 更新导入路径
- 使用脚本工具批量更新导入语句
- 创建 `index.ts` 导出文件，简化导入路径
- 统一导入风格，如使用别名以避免相对路径过深

### 5. 实施组件分割
- 将大型组件拆分为更小的独立组件
- 分离视图逻辑和业务逻辑
- 提取可复用的逻辑到自定义Hook中

### 6. 引入路径别名
- 配置 `tsconfig.json` 以支持路径别名：
  ```json
  {
    "compilerOptions": {
      "baseUrl": ".",
      "paths": {
        "@app/*": ["src/*"],
        "@components/*": ["src/components/*"],
        "@services/*": ["src/services/*"],
        "@hooks/*": ["src/hooks/*"],
        "@models/*": ["src/models/*"],
        "@utils/*": ["src/utils/*"]
      }
    }
  }
  ```
- 更新 Babel 配置支持路径别名
- 修改所有导入语句以使用新的别名

### 7. 测试和修复
- 编写迁移测试脚本，测试关键功能
- 使用静态分析工具检查导入错误
- 修复在重构过程中发现的问题
- 进行全面的手动测试

### 8. 文档更新
- 更新开发文档，反映新的目录结构
- 创建架构图，说明各模块之间的关系
- 添加代码规范文档，指导未来开发

## 相关文件
- 所有源代码文件
- `tsconfig.json` - TypeScript配置
- `babel.config.js` - Babel配置
- `package.json` - 项目配置

## 注意事项
- 制定详细的迁移计划，尽量减少一次性修改过多文件
- 频繁提交代码，每完成一个小的重构就提交一次
- 保持功能测试，确保重构不会破坏现有功能
- 使用自动化工具辅助重构过程
- 考虑在迁移过程中引入更严格的类型检查
- 借此机会清理冗余代码和未使用的导入
- 避免在重构的同时引入新功能，除非必要
- 确保移动设备上的性能不会因重构而下降 