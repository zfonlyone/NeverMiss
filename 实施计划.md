# NeverMiss 项目实施计划

## 任务0：数据库版本与应用信息集成
- [x] 修改数据库存储，在导出中包含应用版本和数据库版本
  - [x] 更新 `exportService.ts` 以在导出函数中包含详细版本信息
  - [x] 更新数据导出/导入函数以包含 APP_INFO
  - [x] 测试导出功能是否正确保存版本信息

## 任务1：农历支持 (进行中)
- [ ] 更新任务模型以支持农历日期
  - [ ] 增强 `Task.ts` 模型以完全支持农历日期属性
  - [ ] 创建 LunarDatePicker 组件用于 UI 交互
- [ ] 更新 TaskFormInline 组件
  - [ ] 添加农历切换开关
  - [ ] 实现公历和农历之间的日期转换
- [ ] 更新 RecurrenceSettings 以支持农历
  - [ ] 在循环计算中添加农历日期处理
  - [ ] 在 UI 中实现农历月份和年份显示

## 任务2：增强循环设置功能
- [ ] 创建模块化 RecurrenceSettingsWidget 组件
  - [ ] 从当前 RecurrenceSettings 提取核心功能
  - [ ] 使其可在不同屏幕中重用
- [ ] 实现高级循环模式
  - [ ] 添加"大/小周"切换（交替周）
  - [ ] 添加"按日期每月"（例如，每个月的15日）
  - [ ] 添加"按天每年"（例如，每年的第100天）
  - [ ] 实现"按星期几每周"（例如，每周一）
  - [ ] 实现"按星期几每月"（例如，每月第一个星期一）
- [ ] 更新新循环选项的 UI
  - [ ] 为每种模式类型创建选择控件
  - [ ] 实现所选模式的预览文本

## 任务3：任务周期管理
- [ ] 创建 TaskCycleWidget 组件
  - [ ] 将周期设置逻辑提取到单独的组件
  - [ ] 使其可在不同屏幕中重用
- [ ] 修复任务完成逻辑
  - [ ] 修复任务完成以正确生成下一个周期
  - [ ] 更新完成日期处理
- [ ] 实现不同的周期创建规则
  - [ ] 已完成任务：使用完成日期 + 循环天数
  - [ ] 过期任务：使用截止日期 + 循环天数
  - [ ] 将已完成任务添加到统计信息
  - [ ] 将逾期任务添加到统计信息

## 任务5：任务标签和背景
- [ ] 更新任务模型以支持标签
  - [ ] 向 Task 接口添加 tags 属性
  - [ ] 更新数据库架构
- [ ] 实现标签管理 UI
  - [ ] 创建标签编辑器 UI
  - [ ] 在任务表单中添加标签选择
- [ ] 为任务列表添加背景自定义
  - [ ] 添加背景颜色/模式属性
  - [ ] 创建背景选择的 UI

## 任务6：任务列表增强
- [ ] 实现排序功能
  - [ ] 添加排序选项（按日期、名称、优先级）
  - [ ] 创建排序选择的 UI
- [ ] 添加筛选功能
  - [ ] 实现按标签、状态、日期范围筛选
  - [ ] 创建筛选 UI 组件
- [ ] 添加搜索功能
  - [ ] 实现跨任务属性的搜索
  - [ ] 创建带有建议的搜索 UI

## 任务7：通知改进
- [ ] 实现通知栏常驻功能
  - [ ] 为 Android 创建前台服务
  - [ ] 添加启用/禁用设置选项
- [ ] 增强通知时机
  - [ ] 使用早上 6 点作为日边界而不是午夜
  - [ ] 按日边界分组任务
- [ ] 改进任务完成记录
  - [ ] 准确记录完成时间
  - [ ] 实现每日任务摘要

## 任务8：代码重组
- [ ] 重构代码结构
  - [ ] 将组件移动到适当的目录
  - [ ] 按功能/功能组织
- [ ] 修复导入路径
  - [ ] 重组后更新所有导入路径
  - [ ] 确保兼容性

## 任务9：UI 改进和自动化构建
- [ ] 更新应用图标和启动屏幕
  - [ ] 设计新的图标资源
  - [ ] 创建新的启动屏幕
- [ ] 实现 GitHub Actions 工作流
  - [ ] 创建自动构建的构建配置
  - [ ] 设置发布工作流

---

# 实施日志

## 初始设置
- 分析了代码库结构和现有功能
- 确定了每个任务要修改的关键组件
- 确定了任务之间的依赖关系，以确定最佳执行顺序

## 任务0进展（2024年7月3日）
- 数据库版本跟踪基本实现完成
- 完善了导出数据格式，添加了详细版本信息
- 更新了数据导入功能，实现了版本兼容性检查
- 创建了测试页面用于实际验证

## 任务0完成（2024年7月4日）
- 所有功能均已实现并经过测试
- 导出数据格式中成功集成了应用版本和数据库版本信息
- 版本兼容性检查功能正常工作，禁止高版本数据导入低版本应用
- 更新了文档和测试计划

## 任务1进展（2024年7月5日）
- 完成了详细的实施计划，包括LunarDatePicker组件设计
- 分析了现有农历相关功能和需要增强的部分
- 规划了实施步骤和测试策略 