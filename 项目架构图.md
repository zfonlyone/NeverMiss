# NeverMiss 项目架构图

## 整体架构

```
+------------------+     +-------------------+     +-------------------+
|                  |     |                   |     |                   |
|    界面层        |     |      业务层       |     |      数据层       |
|                  |     |                   |     |                   |
+------------------+     +-------------------+     +-------------------+
| - 页面组件        |     | - 任务服务        |     | - 本地存储服务     |
| - 小组件          |     | - 通知服务        |     | - 数据库服务       |
| - 导航            |     | - 农历服务        |     | - 迁移服务         |
| - 主题和样式      |     | - 权限服务        |     | - 导入/导出服务    |
+------------------+     +-------------------+     +-------------------+
```

## 数据模型

```
+---------------+     +----------------+     +----------------+
|     Task      |1    |  TaskCycle     |*    |  TaskHistory   |
|---------------|---->|----------------|---->|----------------|
| id            |     | id             |     | id             |
| title         |     | taskId         |     | taskId         |
| description   |     | startDate      |     | cycleId        |
| recurrence    |     | dueDate        |     | timestamp      |
| reminder      |     | isCompleted    |     | action         |
| dateType      |     | isOverdue      |     | status         |
| ...           |     | completedDate  |     | ...            |
+---------------+     +----------------+     +----------------+
```

## 主要组件和数据流

```
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|   任务列表页    |---->|   任务表单     |---->|  循环设置组件   |
|                |     |                |     |                |
+----------------+     +----------------+     +----------------+
        |                     |                      |
        v                     v                      v
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|   任务详情     |---->|   任务服务     |---->|   存储服务     |
|                |     |                |     |                |
+----------------+     +----------------+     +----------------+
                              |
                              v
                      +----------------+
                      |                |
                      |   通知服务     |
                      |                |
                      +----------------+
```

## 文件结构

```
NeverMiss/
├── app/                # 基于 Expo Router 的页面文件
│   ├── index.tsx       # 首页/任务列表
│   ├── tasks.tsx       # 任务管理
│   ├── statistics.tsx  # 统计页面
│   ├── settings.tsx    # 设置页面
│   └── ...
├── components/         # 可复用组件
│   ├── TaskList.tsx    # 任务列表组件
│   ├── TaskFormInline.tsx # 任务表单
│   ├── TaskDetail.tsx  # 任务详情
│   ├── RecurrenceSettings.tsx # 循环设置
│   └── ...
├── models/             # 数据模型定义
│   ├── Task.ts         # 任务模型
│   ├── TaskCycle.ts    # 任务周期模型
│   └── TaskHistory.ts  # 任务历史模型
├── services/           # 业务服务
│   ├── taskService.ts  # 任务服务
│   ├── notificationService.ts # 通知服务
│   ├── lunarService.ts # 农历服务
│   └── storageService.ts # 存储服务
├── constants/          # 常量定义
├── hooks/              # 自定义钩子
├── contexts/           # React Context 定义
└── ...
```

## 待优化的架构

根据任务计划，我们将对项目架构进行以下优化：

1. 组件结构优化：
   - 将大型组件拆分为小组件
   - 创建专用的 widgets 目录

```
components/
├── widgets/
│   ├── RecurrenceSettingsWidget.tsx  # 循环设置小组件
│   ├── TaskCycleWidget.tsx           # 任务周期小组件
│   ├── LunarDatePicker.tsx           # 农历日期选择器
│   └── ...
└── ...
```

2. 数据模型扩展：
   - 扩展 Task 模型支持标签和背景
   - 增强 RecurrencePattern 支持更多循环模式

3. 服务层增强：
   - 增强通知服务支持常驻通知
   - 优化任务服务的周期生成逻辑
   - 完善农历服务功能

4. 性能优化：
   - 实现数据懒加载
   - 优化大量数据的渲染性能 